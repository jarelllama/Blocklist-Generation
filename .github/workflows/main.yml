name: Build Control D AI Malware Blocklist
#run-name:
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Provide Git identity
        run: |
          git config user.email ${{ vars.GIT_EMAIL }}
          git config user.name ${{ vars.GIT_USERNAME }}
  
      - name: Download Tranco TOP1M
        run: |
          wget https://tranco-list.eu/top-1m.csv.zip
          unzip top-1m.csv.zip
          
      - name: Download DomCop TOP10M
        run: |
          wget https://www.domcop.com/files/top/top10milliondomains.csv.zip
          unzip top10milliondomains.csv.zip
          
      - name: Format and merge lists
        run: |
          cut -d ',' -f 2 top-1m.csv > top-1m.txt
          
          # Remove carraige return/CRLF line terminators
          sed 's/\r//' top-1m.txt > top-1m.txt.tmp
          mv top-1m.txt.tmp top-1m.txt
          
          tail -n +2 top10milliondomains.csv \
            | cut -d ',' -f 2 \
            | awk '{gsub(/"/ ,""); print}' > top10milliondomains.txt
            
          cat top-1m.txt top10milliondomains.txt > input.txt
          
          if [[ $(wc -l < input.txt) -ne 11000000 ]]; then
            exit 1
          fi
          
          #awk '{sub("^www\\." ,""); print}' input.txt > 1.tmp
          #mv 1.tmp input.txt
          
          sort -u input.txt -o input.txt
          
          wc -l input.txt
          
          
      
        
          

          
          
          
